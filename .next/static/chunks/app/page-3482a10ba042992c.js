(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{4817:function(e,t,s){Promise.resolve().then(s.bind(s,2612))},2612:function(e,t,s){"use strict";s.d(t,{default:function(){return E}});var a=s(7437),i=s(2265),l=s(8614),r=s(521),n=s(2489),o=s(7337),c=s(9376),d=s(4131),u=s(5863),m=s(4743);function h(){return(0,a.jsxs)("div",{className:"h-full flex flex-col justify-center items-center text-center p-4",children:[(0,a.jsx)(o.Z,{className:"w-16 h-16 text-blue-600 mb-4"}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:(0,a.jsx)("span",{className:"bg-gradient-to-r from-[#0070FF] via-[#0048bb] to-[#002c72] inline-block text-transparent bg-clip-text",children:"Welcome to TwpBot"})}),(0,a.jsx)("p",{className:"text-gray-600 max-w-md",children:"I'm here to help you with your questions. Feel free to ask me anything about the documents!"})]})}var x=s(2023),f=s(5868),p=s(7648);function b(e){let{fetchQ:t,isLoading:s,id:l,user_id:n}=e,[c,d]=(0,i.useState)(""),[u,m]=(0,i.useState)([]);(0,i.useEffect)(()=>{l?h(l):(d(""),m([]))},[l]);let h=async e=>{try{var t;let s=await fetch("/api/documentName",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})}),a=await s.json();if(null===(t=a[0])||void 0===t?void 0:t.name){let e=a[0].name.split(".").shift();d(e),m("Conversation about ".concat(e).split(" "))}}catch(e){console.error("Error fetching document:",e)}},b=async()=>{try{await fetch("/api/clearChat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:n})}),t(),d(""),m([])}catch(e){console.error("Error clearing chat:",e)}};return(0,a.jsx)("header",{className:"bg-gray-50 border-gray-200 border-b",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between items-center py-1 lg:py-4",children:[(0,a.jsxs)("h1",{className:"text-xl font-bold text-gray-900 flex items-center ",children:[(0,a.jsx)(o.Z,{className:"w-8 h-8 text-[#0070FF] hover:text-[#0060FF] mr-3"}),(0,a.jsx)("span",{className:"bg-gradient-to-r from-[#0070FF] via-[#0048bb] to-[#002c72] inline-block text-transparent bg-clip-text",children:"TwpBot"})]}),c&&(0,a.jsx)(p.default,{href:"/documents/".concat(l),children:(0,a.jsxs)(r.E.div,{className:"px-4 py-1 hidden rounded-full bg-blue-50 border border-blue-200 sm:flex items-center space-x-2 hover:bg-blue-100 transition-colors duration-200",whileHover:{scale:1.05},transition:{type:"spring",stiffness:400,damping:10},children:[(0,a.jsx)(x.Z,{className:"w-4 h-4 text-blue-500"}),(0,a.jsx)("div",{className:"text-sm text-[#0070FF] font-medium",children:u.map((e,t)=>(0,a.jsxs)(r.E.span,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.25,delay:t/10},children:[e," "]},t))})]})}),(0,a.jsx)("div",{className:"flex space-x-4",children:(0,a.jsx)("button",{type:"button",disabled:s,onClick:b,className:"p-2 mx-4 rounded-full text-gray-500 hover:text-blue-600 hover:bg-blue-50 focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors duration-200 disabled:opacity-50",title:"Clear chat",children:(0,a.jsx)(f.Z,{className:"w-6 h-6"})})})]})})})}var g=s(2369),y=s(7684),j=s(5675),N=s(7168),w=s(5899),v=s(8848);function S(e){let{message:t,isLoading:s=!1,_id:l,onRefresh:n,onEdit:c}=e,[d,u]=(0,i.useState)(!1),[m,h]=(0,i.useState)("");(0,i.useEffect)(()=>{t.answer&&h(v.Z.sanitize(t.answer,{ALLOWED_TAGS:["b","i","em","strong","a","p","ul","ol","li","code","pre","h1","h2","h3","h4","h5","h6","blockquote","hr","br","table","thead","tbody","tr","th","td"],ALLOWED_ATTR:["href","target","rel"]}))},[t.answer]);let x=async()=>{n(t.query,t._id),u(!1)},f=async()=>{await fetch("/api/deleteChat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({_id:t._id})}),c(t.query,t._id),u(!1)};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)("div",{className:"bg-blue-50 rounded-b-3xl  rounded-tl-3xl p-4 shadow-sm max-w-[80%] md:max-w-[70%] relative ",children:[(0,a.jsxs)("div",{className:"flex items-center mb-2 justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"bg-blue-100 rounded-full p-2 mr-2",children:(0,a.jsx)(g.Z,{className:"w-4 h-4 text-blue-600"})}),(0,a.jsx)("p",{className:"font-medium text-gray-900",children:"You"})]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)("button",{onClick:()=>u(!d),className:"hover:bg-blue-100 rounded-full p-1 transition-colors   ",children:(0,a.jsx)(y.Z,{className:"w-5 h-5 text-gray-600"})}),d&&(0,a.jsxs)("div",{className:"absolute right-0 top-full z-10 mt-1 w-36 bg-white border rounded- shadow-lg",children:[(0,a.jsxs)("button",{onClick:f,className:"flex items-center w-full px-4 py-2  hover:bg-gray-50 text-left rounded-t-lg",children:[(0,a.jsx)(j.Z,{className:"w-4 h-4 mr-2"}),"Edit"]}),(0,a.jsxs)("button",{onClick:x,className:"flex items-center w-full px-4 py-2 hover:bg-gray-50 text-left rounded-b-lg",children:[(0,a.jsx)(N.Z,{className:"w-4 h-4 mr-2"}),"Regenerate"]})]})]})]}),(0,a.jsx)("p",{className:"text-gray-800",children:t.query})]})}),(0,a.jsx)("div",{className:"flex justify-start",children:(0,a.jsx)("div",{className:"bg-white rounded-b-3xl rounded-tr-3xl p-4 shadow-sm md:max-w-[70%] max-w-[90%] border border-gray-200 ".concat("NO"===l?" border border-red-500":""),children:s?(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"bg-blue-100 rounded-full p-2 mr-2",children:(0,a.jsx)(o.Z,{className:"w-4 h-4 text-blue-600"})}),(0,a.jsx)("p",{className:"font-medium text-gray-900 mr-2",children:"TwpBot"}),(0,a.jsxs)("div",{className:"flex space-x-1 items-center",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-bounce"}),(0,a.jsx)("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-bounce [animation-delay:-.3s]"}),(0,a.jsx)("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-bounce [animation-delay:-.5s]"})]})]}):(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center mb-2",children:[(0,a.jsx)("div",{className:"".concat("NO"!==l?"bg-blue-100":"bg-red-100","  rounded-full p-2 mr-2"),children:"NO"!==l?(0,a.jsx)(o.Z,{className:"w-4 h-4 text-blue-600"}):(0,a.jsx)(w.Z,{className:"w-4 h-4 text-red-600"})}),(0,a.jsx)("p",{className:"font-medium text-gray-900",children:"TwpBot"})]}),(0,a.jsx)(r.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.25},className:"text-gray-800 prose prose-sm max-w-none",dangerouslySetInnerHTML:{__html:m}}),"NO"!==l&&(0,a.jsx)(p.default,{href:"/documents/".concat(l),className:"text-blue-600 hover:text-blue-800 text-sm mt-4 inline-block font-medium transition-colors",children:"Read document"})]})})})]})}function _(e){var t;let[s,l]=(0,i.useState)(""),[r,n]=(0,i.useState)([]),[o,c]=(0,i.useState)(!1),[x,f]=(0,i.useState)(""),p=(0,i.useRef)(null),g=d.Z.get("authToken")||e.token;(0,i.useEffect)(()=>{y()},[]);let y=async()=>{let e=await fetch("/api/fetchQueries",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:g,date:""})}),t=await e.json();t&&n(t)},j=async e=>{if(e.preventDefault(),s.trim()){c(!0),f(s),l("");try{if(!(await fetch("/api/conversation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:s.trim(),user_id:g})})).ok)throw Error("Failed to get answer");await y()}catch(e){console.error("Error:",e)}finally{c(!1)}}},N=async(e,t)=>{e.trim()&&(l(e),r.length>=1&&n(r.filter(e=>e._id!==t)))},w=async(e,t)=>{if(c(!0),f(e),e.trim()){l("");try{if(r.length>1&&n(r.filter(e=>e._id!==t)),!(await fetch("/api/conversation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:e.trim(),user_id:g})})).ok)throw Error("Failed to get answer");await y()}catch(e){console.error("Error:",e)}finally{c(!1)}}},v=()=>{p.current&&(p.current.scrollTop=p.current.scrollHeight)};(0,i.useEffect)(()=>{v()},[r,o]);let _=async()=>{y()};return(0,a.jsxs)("div",{className:"flex flex-col h-screen bg-gray-50 ",children:[(0,a.jsx)(b,{fetchQ:_,isLoading:o,id:(null===(t=r[0])||void 0===t?void 0:t.document_id)?r[0].document_id:"",user_id:g}),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("main",{className:"flex-grow overflow-hidden",children:(0,a.jsx)("div",{className:"h-full flex flex-col",children:(0,a.jsx)("div",{className:"flex-grow overflow-y-auto scrollbar-hide scroll-smooth",ref:p,children:0===r.length?o?(0,a.jsx)("div",{className:"space-y-6 p-4 md:p-6 scrollbar-hide scroll-smooth",children:(0,a.jsx)(S,{message:{_id:"loading",query:x,answer:"",created_at:""},isLoading:!0,_id:"",onRefresh:()=>{},onEdit:()=>{}})}):(0,a.jsx)(h,{}):(0,a.jsxs)("div",{className:"space-y-6 p-4 md:p-6 scrollbar-hide scroll-smooth",children:[r.map(e=>(0,a.jsx)(S,{message:e,_id:e.document_id,onRefresh:w,onEdit:N},e._id)),o&&(0,a.jsx)(S,{message:{_id:"loading",query:x,answer:"",created_at:""},isLoading:!0,_id:"",onRefresh:()=>{},onEdit:()=>{}})]})})})}),(0,a.jsx)("footer",{className:"bg-gray-50 p-4",children:(0,a.jsx)("form",{onSubmit:j,className:"max-w-4xl mx-auto ",children:(0,a.jsxs)("div",{className:"relative flex items-center",children:[(0,a.jsx)("input",{type:"text",id:"query",className:"w-full p-4 pr-16 text-gray-900 border border-gray-300 rounded-full bg-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 placeholder-gray-400",placeholder:"Message TwpBot...",value:s,onChange:e=>l(e.target.value)}),(0,a.jsxs)("button",{type:"submit",disabled:o||!s.trim(),className:"absolute right-2 inline-flex items-center justify-center w-12 h-12 text-white  rounded-full bg-[#0070FF] hover:bg-[#0060FF] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200",children:[o?(0,a.jsx)(u.Z,{className:"animate-spin w-5 h-5"}):(0,a.jsx)(m.Z,{className:"w-5 h-5"}),(0,a.jsx)("span",{className:"sr-only",children:"Send"})]})]})})})]})]})}function E(){let[e,t]=(0,i.useState)(!1),[s,c]=(0,i.useState)(d.Z.get("authToken")||"");(0,i.useEffect)(()=>{let e=localStorage.getItem("chatIsOpen");null!==e&&t(JSON.parse(e))},[]);let u=e=>{t(e),localStorage.setItem("chatIsOpen",JSON.stringify(e))};return(0,a.jsxs)(i.Suspense,{fallback:(0,a.jsx)("div",{}),children:[(0,a.jsx)(T,{setToken:c}),(0,a.jsxs)("main",{children:[(0,a.jsx)(l.M,{children:e&&(0,a.jsxs)("div",{children:[(0,a.jsx)(r.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.3},onClick:()=>u(!1)}),(0,a.jsxs)(r.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{type:"spring",damping:25,stiffness:200},children:[(0,a.jsx)("button",{onClick:()=>u(!1),className:"absolute top-2 right-2 p-2 rounded-full hover:bg-gray-100","aria-label":"Close chat",children:(0,a.jsx)(n.Z,{className:"w-4 h-4 text-gray-600"})}),(0,a.jsx)(_,{token:s})]})]})}),(0,a.jsx)(l.M,{children:!e&&(0,a.jsx)(r.E.button,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},exit:{scale:0,opacity:0},transition:{type:"spring",stiffness:260,damping:20},whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>u(!0),className:"fixed bottom-6 right-6 bg-[#0073ff] hover:bg-[#0082FF] text-white p-4 rounded-full shadow-lg transition-colors duration-200","aria-label":"Open chat",children:(0,a.jsx)(o.Z,{className:"w-6 h-6"})})})]})]})}function T(e){let{setToken:t}=e,s=(0,c.useSearchParams)().get("token");return(0,i.useEffect)(()=>{s&&(d.Z.set("authToken",s,{expires:7,sameSite:"None",secure:!0}),t(s))},[s,t]),null}}},function(e){e.O(0,[727,706,971,117,744],function(){return e(e.s=4817)}),_N_E=e.O()}]);