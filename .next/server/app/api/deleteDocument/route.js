"use strict";(()=>{var e={};e.id=903,e.ids=[903],e.modules={21841:e=>{e.exports=require("@aws-sdk/client-s3")},11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84472:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>g,patchFetch:()=>D,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>S,staticGenerationAsyncStorage:()=>y});var n={};r.r(n),r.d(n,{DELETE:()=>p});var o=r(49303),s=r(88716),i=r(60670),a=r(21841),u=r(87070),l=r(75748),c=r(37186);let d=new a.S3Client({region:process.env.AWS_REGION,credentials:{accessKeyId:process.env.AWS_ACCESS_KEY_ID,secretAccessKey:process.env.AWS_SECRET_ACCESS_KEY}});async function p(e){try{await (0,l.Z)();let{id:t}=await e.json(),r=await c.Z.findById(t);if(!r)return u.NextResponse.json({error:"Document not found"},{status:404});if(r.file_key){let e={Bucket:process.env.AWS_S3_BUCKET_NAME,Key:r.file_key};try{await d.send(new a.DeleteObjectCommand(e)),console.log("S3 file deleted successfully:",r.file_key)}catch(e){return console.error("S3 Delete Error:",e),u.NextResponse.json({error:"Failed to delete file from S3"},{status:500})}}return await c.Z.deleteOne({_id:t}),u.NextResponse.json({message:"Document deleted successfully"},{status:200})}catch(e){return console.error("Delete Operation Error:",e),u.NextResponse.json({error:"Failed to delete document"},{status:500})}}let m=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/deleteDocument/route",pathname:"/api/deleteDocument",filename:"route",bundlePath:"app/api/deleteDocument/route"},resolvedPagePath:"/Users/vigneshk/Desktop/work/TwpDocBot/src/app/api/deleteDocument/route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:f,staticGenerationAsyncStorage:y,serverHooks:S}=m,g="/api/deleteDocument/route";function D(){return(0,i.patchFetch)({serverHooks:S,staticGenerationAsyncStorage:y})}},75748:(e,t,r)=>{r.d(t,{Z:()=>a});var n=r(11185),o=r.n(n);let s=process.env.MONGODB_URI;if(!s)throw Error("Please define the MONGODB_URI environment variable inside .env");let i=global.mongoose;i||(i=global.mongoose={conn:null,promise:null});let a=async function(){if(i.conn)return i.conn;i.promise||(i.promise=o().connect(s,{dbName:"twpbot",bufferCommands:!1}).then(e=>e));try{i.conn=await i.promise}catch(e){throw i.promise=null,e}return i.conn}},37186:(e,t,r)=>{r.d(t,{Z:()=>i});var n=r(11185),o=r.n(n);let s=new(o()).Schema({content:{type:String,required:[!0,"Content is required"]},name:{type:String,required:[!0,"Name is required"]},user_id:{type:String,required:[!0,"User ID is required"]},file_url:{type:String,required:[!0,"File URL is required"]},file_key:{type:String,required:[!0,"File key is required"]},created_at:{type:Date,default:Date.now}}),i=o().models.Document||o().model("Document",s)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[948,972],()=>r(84472));module.exports=n})();