"use strict";(()=>{var e={};e.id=228,e.ids=[228],e.modules={21841:e=>{e.exports=require("@aws-sdk/client-s3")},11185:e=>{e.exports=require("mongoose")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},86451:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>_,patchFetch:()=>v,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>S,staticGenerationAsyncStorage:()=>g});var o={};t.r(o),t.d(o,{POST:()=>c});var n=t(49303),s=t(88716),a=t(60670),i=t(21841),u=t(87070),p=t(75748),d=t(37186);let l=new i.S3Client({region:process.env.AWS_REGION,credentials:{accessKeyId:process.env.AWS_ACCESS_KEY_ID,secretAccessKey:process.env.AWS_SECRET_ACCESS_KEY}});async function c(e){await (0,p.Z)();let r=await e.formData(),t=r.get("name"),o=r.get("user_id"),n=r.get("content"),s=r.get("file"),a=t.replace(/\s+/g,"-");if(!s)return u.NextResponse.json({error:"File is required"},{status:400});let c=await s.arrayBuffer(),m=Buffer.from(c),f=`uploads/${Date.now()}-${a}`,g={Bucket:process.env.AWS_S3_BUCKET_NAME,Key:f,Body:m,ContentType:s.type};try{await l.send(new i.PutObjectCommand(g));let e=`https://${process.env.AWS_S3_BUCKET_NAME}.s3.${process.env.AWS_REGION}.amazonaws.com/${f}`,r=new d.Z({content:n,name:a,user_id:o,file_url:e,file_key:f});return await r.save(),u.NextResponse.json({message:"Document uploaded successfully",fileUrl:e},{status:201})}catch(e){return console.error("S3 Upload Error:",e),u.NextResponse.json({error:"File upload failed"},{status:500})}}let m=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/documentUpload/route",pathname:"/api/documentUpload",filename:"route",bundlePath:"app/api/documentUpload/route"},resolvedPagePath:"/Users/vigneshk/Desktop/work/TwpDocBot/src/app/api/documentUpload/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:f,staticGenerationAsyncStorage:g,serverHooks:S}=m,_="/api/documentUpload/route";function v(){return(0,a.patchFetch)({serverHooks:S,staticGenerationAsyncStorage:g})}},75748:(e,r,t)=>{t.d(r,{Z:()=>i});var o=t(11185),n=t.n(o);let s=process.env.MONGODB_URI;if(!s)throw Error("Please define the MONGODB_URI environment variable inside .env");let a=global.mongoose;a||(a=global.mongoose={conn:null,promise:null});let i=async function(){if(a.conn)return a.conn;a.promise||(a.promise=n().connect(s,{dbName:"twpbot",bufferCommands:!1}).then(e=>e));try{a.conn=await a.promise}catch(e){throw a.promise=null,e}return a.conn}},37186:(e,r,t)=>{t.d(r,{Z:()=>a});var o=t(11185),n=t.n(o);let s=new(n()).Schema({content:{type:String,required:[!0,"Content is required"]},name:{type:String,required:[!0,"Name is required"]},user_id:{type:String,required:[!0,"User ID is required"]},file_url:{type:String,required:[!0,"File URL is required"]},file_key:{type:String,required:[!0,"File key is required"]},created_at:{type:Date,default:Date.now}}),a=n().models.Document||n().model("Document",s)}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[948,972],()=>t(86451));module.exports=o})();